Drop Schema If Exists Rabbitask;
Create Schema Rabbitask;
Use Rabbitask;

Create Table tipo_usuario(
	cd_tipo_usuario int,
	nm_tipo_usuario varchar(250),
    constraint pk_tipo_usuario primary key (cd_tipo_usuario)
);

Create Table usuario
(
	cd_usuario int AUTO_INCREMENT,
    nm_usuario varchar(64),
    nm_email varchar(254),
    nm_senha varchar(255), -- nova coluna para senha
    cd_telefone varchar (30),
    cd_tipo_usuario int,
	UNIQUE INDEX(nm_email),
	constraint pk_usuario primary key (cd_usuario),
	constraint fk_usuario_tipo_usuario foreign key (cd_tipo_usuario) references tipo_usuario (cd_tipo_usuario)
);

Create Table conexao_usuario
(
	cd_usuario int,
    cd_usuario_agente int,
	constraint pk_conexao_usuario primary key (cd_usuario, cd_usuario_agente),
	constraint fk_conexao_usuario_usuario foreign key (cd_usuario) references usuario (cd_usuario),
	constraint fk_conexao_usuario_agente_usuario foreign key (cd_usuario_agente) references usuario (cd_usuario)
);

Create Table tag
(
	cd_tag int,
    nm_tag varchar(250),
	constraint pk_tag primary key (cd_tag)
);

Create Table tipo_sentimento
(
	cd_tipo_sentimento int,
    nm_tipo_sentimento varchar(250),
	constraint pk_tipo_sentimento primary key (cd_tipo_sentimento)
);

Create Table prioridade
(
	cd_prioridade int,
    nm_prioridade varchar(250),
	constraint pk_prioridade primary key (cd_prioridade)
);

Create Table tarefa
(
	cd_tarefa int,
    nm_tarefa varchar(250),
	cd_prioridade int,
    ds_tarefa varchar(2000),
    dt_prazo datetime,
    cd_usuario_proprietario int,
    cd_usuario int,
    dt_criacao datetime,
    dt_conclusao datetime,
	constraint pk_tarefa primary key (cd_usuario, cd_tarefa),
   	constraint fk_tarefa_usuario_proprietario foreign key (cd_usuario_proprietario) references usuario (cd_usuario),
   	constraint fk_tarefa_usuario foreign key (cd_usuario) references usuario (cd_usuario),
	constraint fk_tarefa_prioridade foreign key (cd_prioridade) references prioridade (cd_prioridade)
);

Create Table tarefa_tag(
	cd_tag int,
    cd_usuario int,
    cd_tarefa int,
    constraint pk_tarefa_tag primary key (cd_tag, cd_usuario, cd_tarefa),
    constraint fk_tarefa_tag_tag foreign key (cd_tag) references tag (cd_tag),
	constraint fk_tarefa_tag_tarefa foreign key (cd_usuario, cd_tarefa) references tarefa (cd_usuario, cd_tarefa)
);

Create Table tarefa_feedback
(
	cd_tipo_sentimento int,
    cd_usuario int,
    cd_tarefa int,
    ds_feedback varchar(2000),
    constraint pk_tarefa_feedback primary key (cd_tipo_sentimento, cd_usuario, cd_tarefa),
    constraint fk_tarefa_feedback_tipo_sentimento foreign key (cd_tipo_sentimento) references tipo_sentimento (cd_tipo_sentimento),
    constraint fk_tarefa_feedback_tarefa foreign key (cd_usuario, cd_tarefa) references tarefa (cd_usuario, cd_tarefa)
);

Create Table topico
(
	cd_topico int,
    nm_topico varchar(250),
    cd_usuario int,
    cd_tarefa int,
    ic_concluido bool,
	constraint pk_topico primary key (cd_topico, cd_usuario, cd_tarefa),
    constraint fk_topico_tarefa foreign key (cd_usuario, cd_tarefa) references tarefa (cd_usuario, cd_tarefa)
);

Create Table anexo
(
	cd_anexo int,
    cd_usuario int,
    cd_tarefa int,
    nm_caminho_anexo varchar(500),
	constraint pk_anexo primary key (cd_anexo, cd_usuario, cd_tarefa),
    constraint fk_anexo_tarefa foreign key (cd_usuario, cd_tarefa) references tarefa (cd_usuario, cd_tarefa)
);

CREATE TABLE codigo_conexao (
    id INT AUTO_INCREMENT PRIMARY KEY,
    codigo VARCHAR(8) NOT NULL,
    cd_usuario INT NOT NULL,
    data_criacao DATETIME NOT NULL,
    data_expiracao DATETIME NOT NULL,
    usado BOOLEAN NOT NULL DEFAULT FALSE,
    
    INDEX idx_codigo_conexao_codigo (codigo),
    INDEX idx_codigo_conexao_usuario (cd_usuario),
    
    CONSTRAINT fk_codigo_conexao_usuario 
        FOREIGN KEY (cd_usuario) 
        REFERENCES usuario(cd_usuario) 
        ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;


INSERT INTO tipo_usuario (cd_tipo_usuario,nm_tipo_usuario) values (1,"Usuário Comum");
INSERT INTO tipo_usuario (cd_tipo_usuario,nm_tipo_usuario) values (2,"Agente");

-- senha: senha123
INSERT INTO usuario (cd_usuario,nm_usuario,nm_email,nm_senha,cd_telefone,cd_tipo_usuario) 
VALUES (1,"João da Silva","joao.silva@email.com","/uISX1ElIaYLCKQEsEW/M2mlpQMhB3G+7aJfS/ETTF4=","+551199684529",1);

INSERT INTO usuario (cd_usuario,nm_usuario,nm_email,nm_senha,cd_telefone,cd_tipo_usuario) 
VALUES (2,"Maria Santos","maria.santos@email.com","/uISX1ElIaYLCKQEsEW/M2mlpQMhB3G+7aJfS/ETTF4=","+551965239810",1);

INSERT INTO usuario (cd_usuario,nm_usuario,nm_email,nm_senha,cd_telefone,cd_tipo_usuario) 
VALUES (3,"Pedro Ferreira","pedro.ferreira@email.com", "/uISX1ElIaYLCKQEsEW/M2mlpQMhB3G+7aJfS/ETTF4=","+551839789368",1);

INSERT INTO usuario (cd_usuario,nm_usuario,nm_email,nm_senha,cd_telefone,cd_tipo_usuario) 
VALUES (4,"Ana Oliveira","ana.oliveira@email.com","/uISX1ElIaYLCKQEsEW/M2mlpQMhB3G+7aJfS/ETTF4=","+551210398501",2);

INSERT INTO usuario (cd_usuario,nm_usuario,nm_email,nm_senha,cd_telefone,cd_tipo_usuario) 
VALUES (5,"Carlos Rodrigues","carlos.rodrigues@email.com","/uISX1ElIaYLCKQEsEW/M2mlpQMhB3G+7aJfS/ETTF4=","+551734987747",2);

INSERT INTO conexao_usuario (cd_usuario,cd_usuario_agente) values (1,4);
INSERT INTO conexao_usuario (cd_usuario,cd_usuario_agente) values (2,4);
INSERT INTO conexao_usuario (cd_usuario,cd_usuario_agente) values (3,4);
INSERT INTO conexao_usuario (cd_usuario,cd_usuario_agente) values (4,5);

INSERT INTO prioridade (cd_prioridade,nm_prioridade) values (1,"Super Alta");
INSERT INTO prioridade (cd_prioridade,nm_prioridade) values (2,"Alta");
INSERT INTO prioridade (cd_prioridade,nm_prioridade) values (3,"Média Alta");
INSERT INTO prioridade (cd_prioridade,nm_prioridade) values (4,"Média ");
INSERT INTO prioridade (cd_prioridade,nm_prioridade) values (5,"Média Baixa");
INSERT INTO prioridade (cd_prioridade,nm_prioridade) values (6,"Baixa");
INSERT INTO prioridade (cd_prioridade,nm_prioridade) values (7,"Super Baixa");

INSERT INTO tag (cd_tag, nm_tag) value (1,"Escolar");
INSERT INTO tag (cd_tag, nm_tag) value (2, "Escola");
INSERT INTO tag (cd_tag, nm_tag) value (3, "Português");
INSERT INTO tag (cd_tag, nm_tag) value (4, "Matemática");
INSERT INTO tag (cd_tag, nm_tag) value (5, "Inglês");
INSERT INTO tag (cd_tag, nm_tag) value (6, "Geografia");
INSERT INTO tag (cd_tag, nm_tag) value (7, "Espanhol");
INSERT INTO tag (cd_tag, nm_tag) value (8, "Filosofia");
INSERT INTO tag (cd_tag, nm_tag) value (9, "Casa");
INSERT INTO tag (cd_tag, nm_tag) value (10, "Trabalho");
INSERT INTO tag (cd_tag, nm_tag) value (11, "Trabalho Escolar");
INSERT INTO tag (cd_tag, nm_tag) value (12, "Lição de Casa");
INSERT INTO tag (cd_tag, nm_tag) value (13, "Limpeza da Casa");
INSERT INTO tag (cd_tag, nm_tag) value (14,"Extras");
INSERT INTO tag (cd_tag, nm_tag) value (15,"Extra");
INSERT INTO tag (cd_tag, nm_tag) value (16,"Sociologia");
INSERT INTO tag (cd_tag, nm_tag) value (17,"Biologia");
INSERT INTO tag (cd_tag, nm_tag) value (18,"Física");

INSERT INTO tipo_sentimento (cd_tipo_sentimento,nm_tipo_sentimento) values (1,'Satisfação');
INSERT INTO tipo_sentimento (cd_tipo_sentimento,nm_tipo_sentimento) values (2,'Confiança');
INSERT INTO tipo_sentimento (cd_tipo_sentimento,nm_tipo_sentimento) values (3,'Surpresa');
INSERT INTO tipo_sentimento (cd_tipo_sentimento,nm_tipo_sentimento) values (4,'Alegria');
INSERT INTO tipo_sentimento (cd_tipo_sentimento,nm_tipo_sentimento) values (5,'Felicidade');
INSERT INTO tipo_sentimento (cd_tipo_sentimento,nm_tipo_sentimento) values (6,'Gratidão');
INSERT INTO tipo_sentimento (cd_tipo_sentimento,nm_tipo_sentimento) values (7,'Orgulho');
INSERT INTO tipo_sentimento (cd_tipo_sentimento,nm_tipo_sentimento) values (8,'Inspiração');
INSERT INTO tipo_sentimento (cd_tipo_sentimento,nm_tipo_sentimento) values (9,'Apreciação');
INSERT INTO tipo_sentimento (cd_tipo_sentimento,nm_tipo_sentimento) values (10,'Aprovação');
INSERT INTO tipo_sentimento (cd_tipo_sentimento,nm_tipo_sentimento) values (11,'Curiosidade');
INSERT INTO tipo_sentimento (cd_tipo_sentimento,nm_tipo_sentimento) values (12,'Dúvida');
INSERT INTO tipo_sentimento (cd_tipo_sentimento,nm_tipo_sentimento) values (13,'Confusão');
INSERT INTO tipo_sentimento (cd_tipo_sentimento,nm_tipo_sentimento) values (14,'Desapontamento');
INSERT INTO tipo_sentimento (cd_tipo_sentimento,nm_tipo_sentimento) values (15,'Frustração');
INSERT INTO tipo_sentimento (cd_tipo_sentimento,nm_tipo_sentimento) values (16,'Preocupação');
INSERT INTO tipo_sentimento (cd_tipo_sentimento,nm_tipo_sentimento) values (17,'Desaprovação');
INSERT INTO tipo_sentimento (cd_tipo_sentimento,nm_tipo_sentimento) values (18,'Decepção');
INSERT INTO tipo_sentimento (cd_tipo_sentimento,nm_tipo_sentimento) values (19,'Aversão');

INSERT INTO tarefa (cd_tarefa,nm_tarefa,cd_prioridade,ds_tarefa,dt_prazo,cd_usuario_proprietario,cd_usuario,dt_criacao,dt_conclusao) 
VALUES (1,"Exercícios de Matemática",3,"Fazer exercícios do livro azul. Página 145 exercícios 1-15",'2025-11-22 08:00:00',2,2,'2025-11-15 08:00:00','2025-11-21 16:21:42');

INSERT INTO tarefa (cd_tarefa,nm_tarefa,cd_prioridade,ds_tarefa,dt_prazo,cd_usuario_proprietario,cd_usuario,dt_criacao,dt_conclusao) 
VALUES (1,"Trabalho de Geografia sobre países",3,"Trabalho sobre o Equador: população, PIB, relevo, biomas e pontos turísticos",'2025-09-25 11:43:30',5,3,'2025-08-22 10:50:00','2025-09-24 10:50:00');

INSERT INTO tarefa (cd_tarefa,nm_tarefa,cd_prioridade,ds_tarefa,dt_prazo,cd_usuario_proprietario,cd_usuario,dt_criacao,dt_conclusao) 
VALUES (2,"Tirar Lixo da Lixeira",2,"Retirar o lixo da lixeira grande e colocar para fora de casa",'2025-08-22 23:30:00',3,3,'2025-08-22 21:00:00','2025-08-22 23:00:00');

INSERT INTO tarefa (cd_tarefa,nm_tarefa,cd_prioridade,ds_tarefa,dt_prazo,cd_usuario_proprietario,cd_usuario,dt_criacao,dt_conclusao) 
VALUES (2,'Fazer o trabalho de História',6,'Pesquisar sobre a Proclamação da República e escrever um texto de 3 páginas.','2025-11-30 11:38:32',2,2,'2025-11-20 10:51:00',NULL);

INSERT INTO tarefa (cd_tarefa,nm_tarefa,cd_prioridade,ds_tarefa,dt_prazo,cd_usuario_proprietario,cd_usuario,dt_criacao,dt_conclusao) 
VALUES (1,'Ler capítulo 5 de Física',4,'Ler sobre leis de Newton para a aula de amanhã.','2025-10-23 09:40:00',1,1,'2025-10-22 15:53:12 ','2025-10-22 19:05:34');

INSERT INTO tarefa (cd_tarefa,nm_tarefa,cd_prioridade,ds_tarefa,dt_prazo,cd_usuario_proprietario,cd_usuario,dt_criacao,dt_conclusao) 
VALUES (3,'Projeto final de Programação Web',1,'Desenvolver um sistema de login e cadastro em Python.','2025-12-15 13:30:00',3,3,'2025-11-07 13:56:06','2025-12-15 23:56:42');

-- Para tarefa (2,1)
INSERT INTO topico VALUES (1,'Resolver exercícios 1-5',2,1,false);
INSERT INTO topico VALUES (2,'Resolver exercícios 6-10',2,1,false);
INSERT INTO topico VALUES (3,'Resolver exercícios 11-15',2,1,true);

-- Para tarefa (3,1)
INSERT INTO topico VALUES (1,'Pesquisar população',3,1,true);
INSERT INTO topico VALUES (2,'Pesquisar PIB',3,1,false);
INSERT INTO topico VALUES (3,'Pesquisar relevo e biomas',3,1,false);
INSERT INTO topico VALUES (4,'Pesquisar pontos turísticos',3,1,false);

-- Para tarefa (3,2)
INSERT INTO topico VALUES (1,'Juntar o lixo',3,2,true);
INSERT INTO topico VALUES (2,'Levar o lixo para fora',3,2,true);

-- Para tarefa (2,2)
INSERT INTO topico VALUES (1,'Pesquisar proclamação da república',2,2,false);
INSERT INTO topico VALUES (2,'Escrever rascunho',2,2,false);
INSERT INTO topico VALUES (3,'Revisar e finalizar texto',2,2,false);

-- Para tarefa (1,1)
INSERT INTO topico VALUES (1,'Ler seção 1',1,1,true);
INSERT INTO topico VALUES (2,'Ler seção 2',1,1,true);
INSERT INTO topico VALUES (3,'Ler seção 3',1,1,false);

-- Para tarefa (3,3)
INSERT INTO topico VALUES (1,'Criar tela de login',3,3,true);
INSERT INTO topico VALUES (2,'Implementar autenticação',3,3,false);
INSERT INTO topico VALUES (3,'Implementar cadastro de usuários',3,3,false);
INSERT INTO topico VALUES (4,'Testes finais',3,3,false);

INSERT INTO tarefa_feedback VALUES (1,2,1,"Consegui realizar todos os exercícios com relativa facilidade.");
INSERT INTO tarefa_feedback VALUES (2,3,1,"Estou confiante sobre a apresentação desse trabalho, gostei muito de pesquisar sobre os países.");
INSERT INTO tarefa_feedback VALUES (5,3,2,"O lixo não estava muito cheio");
INSERT INTO tarefa_feedback VALUES (10,1,1,"Foram lidas todas as 3 páginas.");
INSERT INTO tarefa_feedback VALUES (16,3,3,"Estou preocupado com meu desempenho neste trabalho. Acho que o resultado não foi o esperado.");
